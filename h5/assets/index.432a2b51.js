import{D as e,a5 as a,G as s,S as l,Y as t,aO as i,aP as o,aQ as u,aR as r,aS as n,d as c,y as p,aE as m,T as d,J as f,o as _,c as g,w as y,X as h,v,b,F as k,l as T,O as x,x as w,h as j,k as C,q as z,a as D,N as F,r as O,Q as P,i as S,m as L,R as I,_ as U}from"./index-9a4aa426.js";import{_ as $}from"./progress.cde25a10.js";import{_ as A}from"./button.37ee0c5d.js";import{u as E}from"./form.b2296b86.js";import{u as N}from"./useTranslate.6f3ff1af.js";const Q={...e,name:a("file"),url:String,sourceType:s(["album","camera"]),mediaType:s(["image","video","mix"]),timeout:l(3e4),fileList:s([]),isPreview:t,listType:a("picture"),isDeletable:t,method:a("post"),capture:Boolean,maximize:l(Number.MAX_VALUE),maximum:l(9),accept:a("image"),headers:{type:Object,default:{}},data:{type:Object,default:{}},xhrState:l(200),multiple:t,disabled:Boolean,autoUpload:t,beforeUpload:{type:Function,default:null},beforeDelete:{type:Function,default:null},maxDuration:l(60),sizeType:s(["compressed","original"]),camera:a("back"),mode:a("aspectFit")},B={start:e=>e instanceof Object,progress:e=>e instanceof Object,"update:fileList":e=>e instanceof Object,oversize:e=>e instanceof Object,success:e=>e instanceof Object,failure:e=>e instanceof Object,change:e=>e instanceof Object,delete:e=>e instanceof Object,fileItemClick:e=>e instanceof Object};function G(e,a){return["[object Object]","[object File]"].includes(Object.prototype.toString.call(e))?r(e,a):{}}function R(e){return e.tempFiles.map((e=>({...G(e,["path"]),type:"image",url:e.path,thumb:e.path,size:e.size,name:e.name||"image"})))}function X({accept:e,multiple:a,maxDuration:s,sizeType:l,camera:t},r,n){return new Promise(((a,s)=>{"image"===e?i({count:r.multiple?1*r.maximum-r.fileList.length:1,sizeType:l,sourceType:r.sourceType,success:e=>{a(R(e))},fail:s}):"video"===e?o({sourceType:r.sourceType,success:e=>{a(function(e){return[{...G(e.tempFile,["path"]),type:"video",url:e.tempFilePath,thumb:e.tempFilePath,size:e.tempFile.size,name:e.tempFile.name||"video"}]}(e))},fail:s}):"all"===e&&u({type:"all",count:r.multiple?1*r.maximum-r.fileList.length:1,sizeType:l,sourceType:r.sourceType,success:e=>{a(R(e))},fail:s})}))}const q=`${I}-uploader`,{translate:H}=N(q),J=c({name:q,options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}}),M=U(c({...J,props:Q,emits:B,setup(e,{expose:a,emit:s}){const l=e,t=s;a({submit:function(){Promise.all(o.value).then((e=>{e.forEach((e=>e.upload()))}))},chooseImage:N,clearUploadQueue:I});const i=p(l.fileList),o=p([]),u=E(m(l,"disabled"));function r(e){t("fileItemClick",{fileItem:e})}function c(e,a){const{type:s,url:u,formData:r}=e,c={url:l.url?l.url:"",filePath:u,name:l.name,fileType:s,header:l.headers,timeout:+(null==l?void 0:l.timeout),xhrState:+l.xhrState,formData:r,file:e,onStart:s=>{e.status="ready",e.message=H("readyUpload"),I(a),t("start",s)},onProgress:(a,s)=>{e.status="uploading",e.message=H("uploading"),e.percentage=null==a?void 0:a.progress,t("progress",{event:a,option:s,percentage:e.percentage})},onSuccess:(a,s)=>{e.status="success",e.message=H("success"),t("success",{data:a,responseText:a,option:s,fileItem:e}),t("update:fileList",i.value)},onFailure:(a,s)=>{e.status="error",e.message=H("error"),t("failure",{data:a,responseText:a,option:s,fileItem:e})}},p=(m=c,{upload:()=>{var e;const a=n({url:m.url,fileType:m.fileType,file:m.file,filePath:m.filePath,name:m.name,header:m.header,timeout:m.timeout,formData:m.formData,success:e=>{var a,s;m.xhrState===e.statusCode?null==(a=m.onSuccess)||a.call(m,e,m):null==(s=m.onFailure)||s.call(m,e,m)},fail:e=>{var a;null==(a=m.onFailure)||a.call(m,e,m)}});null==(e=m.onStart)||e.call(m,m),a.onProgressUpdate((e=>{var a;null==(a=m.onProgress)||a.call(m,e,m)}))}});var m;l.beforeUpload?l.beforeUpload(n,c):l.autoUpload?p.upload():o.value.push(new Promise(((e,a)=>{e(p)})))}function I(e=-1){e>-1?o.value.splice(e,1):(o.value=[],i.value.splice(0,i.value.length))}async function U(e,a){I(a),(null==l.beforeDelete||await l.beforeDelete(e,i))&&(i.value.splice(a,1),t("delete",{file:e,fileList:i.value,index:a}))}function N(e){if(u.value)return;const a=1*l.maximum;X({accept:l.accept,multiple:l.multiple,capture:l.capture,maxDuration:+l.maxDuration,sizeType:l.sizeType,camera:l.camera,maxCount:a-i.value.length},l,i.value).then((a=>{const s=function(e){const a=1*l.maximum,s=1*l.maximize,o=new Array;e=e.filter((e=>!(e.size>s&&(o.push(e),1)))),o.length&&t("oversize",o);const u=e.length+i.value.length;return u>a&&e.splice(e.length-(u-a)),e}((new Array).slice.call(a));!function(e){e.forEach(((e,a)=>{let s=e.type;const t=e.tempFilePath||e.path||e.url,o=O({});e.fileType?s=e.fileType:s||!/\.(png|jpeg|jpg|webp|gif)$/i.test(t)&&!t.includes("data:image")||(s="image"),o.uid=(new Date).getTime().toString(),o.path=t,o.name=e.name||t,o.status="ready",o.message=H("waitingUpload"),o.type=s,o.formData=l.data,l.isPreview&&(o.url="video"===s?e.url:t),i.value.push(o),c(o,a)}))}(s),t("change",{fileList:i.value,event:e})}))}d((()=>l.fileList),(()=>{i.value=l.fileList}));const Q=f((()=>P(l,q)));return(e,a)=>{const s=S,l=L;return _(),g(s,{class:x(Q.value),style:F(e.customStyle)},{default:y((()=>[e.$slots.default?(_(),g(s,{key:0,class:"hs-uploader__slot"},{default:y((()=>[h(e.$slots,"default",{},void 0,!0),Number(e.maximum)-i.value.length?(_(),g(A,{key:0,"custom-class":"hs-uploader__input",onClick:N},null,8,["onClick"])):v("",!0)])),_:3})):v("",!0),(_(!0),b(k,null,T(i.value,((a,t)=>(_(),g(s,{key:a.uid,class:x(["hs-uploader__preview",[e.listType]])},{default:y((()=>["picture"!==e.listType||e.$slots.default?"list"===e.listType?(_(),g(s,{key:1,class:"hs-uploader__preview-list"},{default:y((()=>[j(s,{class:x(["hs-uploader__preview-img__file__name",[a.status]]),onClick:e=>r(a)},{default:y((()=>[j(w,{name:"link","custom-class":"hs-uploader__preview-img__file__link"}),j(s,{class:"file-name__tips"},{default:y((()=>[C(z(a.name),1)])),_:2},1024),e.isDeletable&&!D(u)?(_(),g(w,{key:0,name:"del","custom-color":"#808080","custom-class":"hs-uploader__preview-img__file__del",onClick:e=>U(a,t)},null,8,["onClick"])):v("",!0)])),_:2},1032,["class","onClick"]),"uploading"===a.status?(_(),g($,{key:0,size:"small",percentage:a.percentage,"stroke-color":"linear-gradient(270deg, rgba(18,126,255,1) 0%,rgba(32,147,255,1) 32.815625%,rgba(13,242,204,1) 100%)","show-text":!1},null,8,["percentage"])):v("",!0)])),_:2},1024)):v("",!0):(_(),g(s,{key:0,class:"hs-uploader__preview-img"},{default:y((()=>{var i,o;return["success"!==a.status?(_(),g(s,{key:0,class:"hs-uploader__preview__progress"},{default:y((()=>["ready"!==a.status?(_(),b(k,{key:0},["error"===a.status?(_(),g(w,{key:0,name:"failure","custom-color":"#fff"})):(_(),g(w,{key:1,name:"loading","custom-color":"#fff"}))],64)):v("",!0),j(s,{class:"hs-uploader__preview__progress__msg"},{default:y((()=>[C(z(a.message),1)])),_:2},1024)])),_:2},1024)):v("",!0),e.isDeletable&&!D(u)?(_(),g(s,{key:1,class:"close",onClick:e=>U(a,t)},{default:y((()=>[h(e.$slots,"deleteIcon",{},(()=>[j(w,{name:"failure"})]),!0)])),_:2},1032,["onClick"])):v("",!0),((null==(i=null==a?void 0:a.type)?void 0:i.includes("image"))||(null==(o=null==a?void 0:a.type)?void 0:o.includes("video")))&&a.url?(_(),g(l,{key:2,class:"hs-uploader__preview-img__c",mode:e.mode,src:a.url,onClick:e=>r(a)},null,8,["mode","src","onClick"])):(_(),g(s,{key:3,class:"hs-uploader__preview-img__file"},{default:y((()=>[j(s,{class:"hs-uploader__preview-img__file__name",onClick:e=>r(a)},{default:y((()=>[j(s,{class:"file-name__tips"},{default:y((()=>[C(z(a.name),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)),j(s,{class:"tips"},{default:y((()=>[C(z(a.name),1)])),_:2},1024)]})),_:2},1024))])),_:2},1032,["class"])))),128)),"picture"===e.listType&&!e.$slots.default&&Number(e.maximum)-i.value.length?(_(),g(s,{key:1,class:x(["hs-uploader__upload",[e.listType]])},{default:y((()=>[h(e.$slots,"uploadIcon",{},(()=>[j(w,{name:"photograph","custom-color":"#808080"})]),!0),j(A,{"custom-class":"hs-uploader__input",class:x({disabled:D(u)}),onClick:N},null,8,["class","onClick"])])),_:3},8,["class"])):v("",!0)])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-610d979a"]]);export{M as _};
