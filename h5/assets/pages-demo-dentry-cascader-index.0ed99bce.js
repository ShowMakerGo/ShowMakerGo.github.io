var e=Object.defineProperty,l=(l,t,a)=>(((l,t,a)=>{t in l?e(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a})(l,"symbol"!=typeof t?t+"":t,a),a);import{D as t,G as a,a5 as i,Y as o,S as s,ab as n,a6 as d,d as u,J as r,y as c,T as v,o as h,c as y,w as p,b as m,F as g,l as f,h as b,O as x,k as C,q as z,x as k,R as A,Q as K,i as _,ak as V,_ as P,ai as S,ac as j,X as B,v as N,a7 as L,r as w,g as $,j as I}from"./index-9a4aa426.js";import{p as U,_ as T}from"./popup.ce3c8dc4.js";import{_ as E,a as G}from"./tabpane.e298c3cb.js";import{u as O}from"./useTranslate.6f3ff1af.js";import{_ as F}from"./cell.b00ee112.js";/* empty css              */import"./transition.47a8b3f2.js";import"./overlay.65ef5d67.js";import"./raf.db71c386.js";import"./useTouch.ef102360.js";import"./useSelectorQuery.5ef6b069.js";import"./useProvide.92abce79.js";import"./useRect.14507623.js";import"./useInject.f710a5e3.js";function Q(e,l,t){return e.map((e=>{const{value:a="value",text:i="text",children:o="children"}=t,{[a]:s,[i]:n,[o]:d,...u}=e,r={loading:!1,...u,level:l?(l&&l.level||0)+1:0,value:s,text:n,children:d,_parent:l};return r.children&&r.children.length&&(r.children=Q(r.children,r,t)),r}))}function H(e,l){let t,a=0;for(;(t=e[a++])&&!0!==l(t);)t.children&&t.children.length&&H(t.children,l)}const R={topId:null,idKey:"id",pidKey:"pid",sortKey:""};const q=class{constructor(e,t){l(this,"nodes"),l(this,"config"),this.config={value:"value",text:"text",children:"children",...t||{}},this.nodes=Q(e,null,this.config)}updateChildren(e,l){l?l.children=Q(e,l,this.config):this.nodes=Q(e,null,this.config)}getNodeByValue(e){let l;return H(this.nodes,(t=>{if(t.value===e)return l=t,!0})),l}getPathNodesByValue(e){if(!e.length)return[];const l=[];let t=this.nodes;for(;t&&t.length;){const a=t.find((l=>l.value===e[l.level]));if(!a)break;l.push(a),t=a.children}return l}isLeaf(e,l){const{leaf:t,children:a}=e,i=Array.isArray(a)&&Boolean(a.length);return null==t?!i&&!l:t}hasChildren(e,l){return l?Array.isArray(e.children)&&Boolean(e.children.length):!this.isLeaf(e,l)}},D={...t,modelValue:Array,visible:Boolean,options:a([]),lazy:Boolean,lazyLoad:Function,valueKey:i("value"),textKey:i("text"),childrenKey:i("children"),convertConfig:Object,title:String,closeIconPosition:String,closeable:Boolean,poppable:o,titleGutter:s(0),titleSize:i("normal"),titleEllipsis:o,titleType:i("line")},J={[n]:(e,l)=>Array.isArray(e)&&Array.isArray(l),[d]:(e,l)=>Array.isArray(e)&&Array.isArray(l),pathChange:e=>Array.isArray(e)},M=u({name:`${A}-cascader-item`,options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}}),W=P(u({...M,props:D,emits:J,setup(e,{emit:l}){const t=e,a=l,i=`${A}-calendar-item`,{translate:o}=O(i),s=r((()=>K(t,i,{"hs-cascader":!0}))),u=r((()=>({lazy:t.lazy,lazyLoad:t.lazyLoad,valueKey:t.valueKey,textKey:t.textKey,childrenKey:t.childrenKey,convertConfig:t.convertConfig}))),P=c(0),S=c(!1),j=c(t.modelValue),B=c(new q([],{})),N=c([]),L=r((()=>u.value.lazy&&Boolean(u.value.lazyLoad))),w=new Map;let $;async function I(){w.clear(),N.value=[],P.value=0,S.value=!1,$=null;let{options:e}=t;u.value.convertConfig&&(e=function(e,l){const t={...R,...l||{}},{topId:a,idKey:i,pidKey:o,sortKey:s}=t;let n=[],d={};return e.forEach((e=>{e={...e};const{[i]:l,[o]:t}=e,s=d[t]=d[t]||[];n.length||t!==a||(n=s),s.push(e),e.children=d[l]||(d[l]=[])})),s&&Object.keys(d).forEach((e=>{d[e].length>1&&d[e].sort(((e,l)=>e[s]-l[s]))})),d=null,n}(e,u.value.convertConfig)),B.value=new q(e,{value:u.value.valueKey,text:u.value.textKey,children:u.value.childrenKey}),L.value&&!B.value.nodes.length&&await T({root:!0,loading:!0,text:"",value:""}),N.value=[{nodes:B.value.nodes,selectedNode:null}],U()}async function U(){const e=j.value;if(void 0===e||!B.value.nodes.length)return;if(0===e.length)return P.value=0,void(N.value=[{nodes:B.value.nodes,selectedNode:null}]);let l=e;if(L.value&&Array.isArray(e)&&e.length){l=[];const t=B.value.nodes.find((l=>l.value===e[0]));if(t){l=[t.value],S.value=!0;const a=await e.slice(1).reduce((async(e,t)=>{var a;const i=await e;await T(i);const o=null==(a=null==i?void 0:i.children)?void 0:a.find((e=>e.value===t));return o&&l.push(t),Promise.resolve(o)}),Promise.resolve(t));await T(a),S.value=!1}}if(l.length&&e===t.modelValue){B.value.getPathNodesByValue(l).forEach(((e,l)=>{P.value=l,Q.handleNode(e,!0)}))}}async function T(e){if(!e)return;if(!u.value.lazyLoad)return void(e.leaf=!0);if(B.value.isLeaf(e,L.value)||B.value.hasChildren(e,L.value))return;e.loading=!0;const l=e.root?null:e;let t=w.get(e);t||(t=new Promise((l=>{var t,a;null==(a=(t=u.value).lazyLoad)||a.call(t,e,l)})),w.set(e,t));const a=await t;Array.isArray(a)&&a.length>0?B.value.updateChildren(a,l):e.leaf=!0,e.loading=!1,w.delete(e)}function F(e){return e.selectedNode?e.selectedNode.text:o("select")}const Q={async handleNode(e,l){const{disabled:t,loading:i}=e;if((l||!t)&&N.value[P.value])if(B.value.isLeaf(e,L.value)){if(e.leaf=!0,N.value[P.value].selectedNode=e,N.value=N.value.slice(0,e.level+1),!l){const e=N.value.map((e=>e.selectedNode));!function(e){const l=e.map((e=>e.value));j.value=l,a(d,l,e),a(n,l,e)}(e),a("pathChange",e)}}else if(B.value.hasChildren(e,L.value)){const t=e.level+1;if(N.value[P.value].selectedNode=e,N.value=N.value.slice(0,t),N.value.push({nodes:e.children||[],selectedNode:null}),P.value=t,!l){const e=N.value.map((e=>e.selectedNode));a("pathChange",e)}}else $=e,i||(await T(e),$===e&&(N.value[P.value].selectedNode=e,Q.handleNode(e,l)))},handleTabClick(e){$=null,P.value=Number(e.paneKey)},isSelected(e,l){var t;return(null==(t=null==e?void 0:e.selectedNode)?void 0:t.value)===l.value}};return v([u,()=>t.options],(()=>{I()}),{deep:!0,immediate:!0}),v((()=>t.modelValue),(e=>{e!==j.value&&(j.value=e,U())})),v((()=>t.visible),(e=>{e&&Array.isArray(j.value)&&j.value.length>0&&U()})),(e,l)=>{const a=_,i=V;return h(),y(G,{modelValue:P.value,"onUpdate:modelValue":l[0]||(l[0]=e=>P.value=e),"custom-class":s.value,"custom-style":e.customStyle,type:t.titleType,ellipsis:t.titleEllipsis,"title-gutter":t.titleGutter,size:t.titleSize,"title-scroll":"",onClick:Q.handleTabClick},{default:p((()=>[!S.value&&N.value.length?(h(!0),m(g,{key:0},f(N.value,((e,l)=>(h(),y(E,{key:l,title:F(e)},{default:p((()=>[b(a,{role:"menu",class:"hs-cascader-pane"},{default:p((()=>[b(i,{"scroll-y":"",style:{height:"100%"}},{default:p((()=>[(h(!0),m(g,null,f(e.nodes,(l=>(h(),y(a,{key:l.value,class:x(["hs-cascader-item",{active:Q.isSelected(e,l),disabled:l.disabled}]),"aria-checked":Q.isSelected(e,l),"aria-disabled":l.disabled||void 0,role:"menuitemradio",onClick:e=>Q.handleNode(l,!1)},{default:p((()=>[b(a,{class:"hs-cascader-item__title"},{default:p((()=>[C(z(l.text),1)])),_:2},1024),l.loading?(h(),y(k,{key:0,loading:"","custom-class":"hs-cascader-item__icon-loading",name:"loading"})):(h(),y(k,{key:1,"custom-class":"hs-cascader-item__icon-check",name:"checklist"}))])),_:2},1032,["aria-checked","aria-disabled","class","onClick"])))),128))])),_:2},1024)])),_:2},1024)])),_:2},1032,["title"])))),128)):(h(),y(E,{key:1,title:"Loading..."},{default:p((()=>[b(a,{class:"hs-cascader-pane"})])),_:1}))])),_:1},8,["modelValue","custom-class","custom-style","type","ellipsis","title-gutter","size","onClick"])}}}),[["__scopeId","data-v-a2c79020"]]),X={...U,...t,modelValue:Array,visible:Boolean,options:a([]),lazy:Boolean,lazyLoad:Function,valueKey:i("value"),textKey:i("text"),childrenKey:i("children"),convertConfig:Object,title:String,closeIconPosition:i("top-right"),closeable:Boolean,poppable:o,titleGutter:s(0),titleSize:i("normal"),titleEllipsis:o,titleType:i("line")},Y={[n]:e=>Array.isArray(e),[d]:(e,l)=>Array.isArray(e)&&Array.isArray(l),[S]:e=>j(e),pathChange:e=>Array.isArray(e)},Z=u({name:`${A}-cascader`,options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}}),ee=P(u({...Z,props:X,emits:Y,setup(e,{emit:l}){const t=e,a=l,i=c(t.modelValue),o=r({get:()=>t.visible,set(e){a(S,e)}});function s(e,l){i.value=e,o.value=!1,a(d,e,l),a(n,e)}function u(e){a("pathChange",e)}return v((()=>t.modelValue),(e=>{e!==i.value&&(i.value=e)})),(e,l)=>{const t=L;return e.poppable?(h(),y(T,{key:0,visible:o.value,"onUpdate:visible":l[0]||(l[0]=e=>o.value=e),position:"bottom","z-index":e.zIndex,"pop-class":"hs-cascader__popup",round:"","custom-class":e.customClass,"custom-style":e.customStyle,closeable:e.closeable,"close-icon":e.closeIcon,"destroy-on-close":!1,"close-icon-position":e.closeIconPosition,"lock-scroll":e.lockScroll},{default:p((()=>[B(e.$slots,"title",{},(()=>[e.title?(h(),y(t,{key:0,class:"hs-cascader__bar",nodes:e.title},null,8,["nodes"])):N("",!0)]),!0),b(W,{"model-value":i.value,options:e.options,lazy:e.lazy,"lazy-load":e.lazyLoad,"value-key":e.valueKey,"text-key":e.textKey,"children-key":e.childrenKey,"convert-config":e.convertConfig,visible:o.value,"title-ellipsis":e.titleEllipsis,"title-gutter":e.titleGutter,"title-size":e.titleSize,"title-type":e.titleType,onChange:s,onPathChange:u},null,8,["model-value","options","lazy","lazy-load","value-key","text-key","children-key","convert-config","visible","title-ellipsis","title-gutter","title-size","title-type"])])),_:3},8,["visible","z-index","custom-class","custom-style","closeable","close-icon","close-icon-position","lock-scroll"])):(h(),y(W,{key:1,"model-value":i.value,options:e.options,lazy:e.lazy,"lazy-load":e.lazyLoad,"value-key":e.valueKey,"text-key":e.textKey,"children-key":e.childrenKey,"convert-config":e.convertConfig,visible:o.value,"title-ellipsis":e.titleEllipsis,"title-gutter":e.titleGutter,"title-size":e.titleSize,"title-type":e.titleType,onChange:s,onPathChange:u},null,8,["model-value","options","lazy","lazy-load","value-key","text-key","children-key","convert-config","visible","title-ellipsis","title-gutter","title-size","title-type"]))}}}),[["__scopeId","data-v-c9092e0a"]]);const le=P({props:{},setup:()=>({demo1:w({visible:!1,value:["湖南"],options:[{value:"浙江",text:"浙江",children:[{value:"杭州",text:"杭州",disabled:!0,children:[{value:"西湖区",text:"西湖区"},{value:"余杭区",text:"余杭区"}]},{value:"温州",text:"温州",children:[{value:"鹿城区",text:"鹿城区"},{value:"瓯海区",text:"瓯海区"}]}]},{value:"湖南",text:"湖南",disabled:!0},{value:"福建",text:"福建",children:[{value:"福州",text:"福州",leaf:!1,children:[]},{value:"厦门",text:"厦门"}]}]}),demo2:w({visible:!1,value:["福建","福州","台江区"],options:[{text:"浙江",items:[{text:"杭州",disabled:!0,items:[{text:"西湖区"},{text:"余杭区"}]},{text:"温州",items:[{text:"鹿城区"},{text:"瓯海区"}]}]},{text:"福建",items:[{text:"福州",items:[{text:"鼓楼区"},{text:"台江区"}]}]}]}),demo3:w({visible:!1,value:["A0","A12","A23","A32"],lazyLoad(e,l){setTimeout((()=>{if(e.root)l([{value:"A0",text:"A0"},{value:"B0",text:"B0"},{value:"C0",text:"C0"}]);else{const{value:t,level:a}=e,i=t.substring(0,1),o=`${i}${a+1}1`,s=`${i}${a+1}2`,n=`${i}${a+1}3`;l([{value:o,text:o,leaf:a>=6},{value:s,text:s,leaf:a>=6},{value:n,text:n,leaf:a>=6}])}}),300)}}),demo4:w({visible:!1,value:[],options:[{value:"A0",text:"A0"},{value:"B0",text:"B0",children:[{value:"B11",text:"B11",leaf:!0},{value:"B12",text:"B12"}]},{value:"C0",text:"C0"}],lazyLoad(e,l){setTimeout((()=>{const{value:t,level:a}=e,i=t.substring(0,1),o=`${i}${a+1}1`,s=`${i}${a+1}2`;l([{value:o,text:o,leaf:a>=2},{value:s,text:s,leaf:a>=1}])}),500)}}),demo5:w({visible:!1,value:["广东省","广州市"],convertConfig:{topId:null,idKey:"id",pidKey:"pid",sortKey:""},options:[{value:"北京",text:"北京",id:1,pid:null},{value:"朝阳区",text:"朝阳区",id:11,pid:1},{value:"亦庄",text:"亦庄",id:111,pid:11},{value:"广东省",text:"广东省",id:2,pid:null},{value:"广州市",text:"广州市",id:21,pid:2}]}),events:{change(...e){console.warn("change",...e)},pathChange(...e){console.warn("pathChange",...e)}}})},[["render",function(e,l,t,a,i,o){const s=F,n=_,d=ee,u=$("layout-default-uni");return h(),y(u,null,{default:p((()=>[I("div",{class:"demo h-100vh!"},[I("h2",{class:"title"}," 基础用法 "),b(s,{title:"选择地址",desc:a.demo1.value.toString()||"请选择地址",onClick:l[0]||(l[0]=e=>a.demo1.visible=!0)},null,8,["desc"]),b(d,{visible:a.demo1.visible,"onUpdate:visible":l[1]||(l[1]=e=>a.demo1.visible=e),modelValue:a.demo1.value,"onUpdate:modelValue":l[2]||(l[2]=e=>a.demo1.value=e),title:"地址选择",options:a.demo1.options,onChange:a.events.change,onPathChange:a.events.pathChange},{title:p((()=>[b(n,{class:"p-20px text-center fw-700"},{default:p((()=>[C(" 地址选择 ")])),_:1})])),_:1},8,["visible","modelValue","options","onChange","onPathChange"]),I("h2",{class:"title"}," 自定义属性名称 "),b(s,{title:"选择地址",desc:a.demo2.value.toString()||"请选择地址",onClick:l[3]||(l[3]=e=>a.demo2.visible=!0)},null,8,["desc"]),b(d,{visible:a.demo2.visible,"onUpdate:visible":l[4]||(l[4]=e=>a.demo2.visible=e),modelValue:a.demo2.value,"onUpdate:modelValue":l[5]||(l[5]=e=>a.demo2.value=e),title:"地址选择","label-key":"text","value-key":"text","children-key":"items",options:a.demo2.options,onChange:a.events.change,onPathChange:a.events.pathChange},null,8,["visible","modelValue","options","onChange","onPathChange"]),I("h2",{class:"title"}," 动态加载 "),b(s,{title:"选择地址",desc:a.demo3.value.toString()||"请选择地址",onClick:l[6]||(l[6]=e=>a.demo3.visible=!0)},null,8,["desc"]),b(d,{visible:a.demo3.visible,"onUpdate:visible":l[7]||(l[7]=e=>a.demo3.visible=e),modelValue:a.demo3.value,"onUpdate:modelValue":l[8]||(l[8]=e=>a.demo3.value=e),title:"地址选择",lazy:"","lazy-load":a.demo3.lazyLoad,onChange:a.events.change,onPathChange:a.events.pathChange},null,8,["visible","modelValue","lazy-load","onChange","onPathChange"]),I("h2",{class:"title"}," 部分数据动态加载 "),b(s,{title:"选择地址",desc:a.demo4.value.toString()||"请选择地址",onClick:l[9]||(l[9]=e=>a.demo4.visible=!0)},null,8,["desc"]),b(d,{visible:a.demo4.visible,"onUpdate:visible":l[10]||(l[10]=e=>a.demo4.visible=e),modelValue:a.demo4.value,"onUpdate:modelValue":l[11]||(l[11]=e=>a.demo4.value=e),title:"地址选择",options:a.demo4.options,lazy:"","lazy-load":a.demo4.lazyLoad,onChange:a.events.change,onPathChange:a.events.pathChange},null,8,["visible","modelValue","options","lazy-load","onChange","onPathChange"]),I("h2",{class:"title"}," 自动转换 "),b(s,{title:"选择地址",desc:a.demo5.value.toString()||"请选择地址",onClick:l[12]||(l[12]=e=>a.demo5.visible=!0)},null,8,["desc"]),b(d,{visible:a.demo5.visible,"onUpdate:visible":l[13]||(l[13]=e=>a.demo5.visible=e),modelValue:a.demo5.value,"onUpdate:modelValue":l[14]||(l[14]=e=>a.demo5.value=e),title:"地址选择",options:a.demo5.options,"convert-config":a.demo5.convertConfig,onChange:a.events.change,onPathChange:a.events.pathChange},null,8,["visible","modelValue","options","convert-config","onChange","onPathChange"])])])),_:1})}]]);export{le as default};
