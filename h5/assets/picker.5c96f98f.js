import{H as e,a6 as t,d as a,r as l,y as s,J as n,T as o,K as i,o as u,c as r,w as c,h as m,N as d,b as h,F as p,l as f,O as v,k as g,q as y,v as b,a as _,aG as k,aU as x,i as N,R as T,b5 as H,_ as w,D as O,G as D,a5 as I,Y,S as C,ax as M,ad as $,ab as P,Q as j,az as S,b6 as V,t as A,X as z}from"./index-9a4aa426.js";import{u as G}from"./useTouch.ef102360.js";import{u as R}from"./useTranslate.6f3ff1af.js";const F={value:[String,Number],columnsType:String,column:{type:Array,default:()=>[]},threeDimensional:{type:Boolean,default:!0},swipeDuration:{type:[Number,String],default:1e3},visibleOptionNum:{type:[Number,String],default:7},optionHeight:{type:[Number,String],default:36},fieldNames:{type:Object,default:()=>({})},uni:{type:Boolean,defualt:!1}},L={[e]:()=>!0,[t]:e=>e instanceof Object||Array.isArray(e)||void 0===e},B=a({name:`${T}-picker-column`,options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}}),E=w(a({...B,props:F,emits:L,setup(e,{expose:a,emit:T}){const w=e,O=T,D=G();a({stopMomentum:q});const I=l({touchParams:{startY:0,endY:0,startTime:0,endTime:0,lastY:0,lastTime:0},currIndex:1,transformY:0,scrollDistance:0,rotation:20}),Y=s(),C=s(!1),M=s(0),$=s(0),P=n((()=>({transition:`transform ${$.value}ms cubic-bezier(0.17, 0.89, 0.45, 1)`,transform:`rotate3d(1, 0, 0, ${M.value})`,top:`calc(50% - ${+w.optionHeight/2}px)`}))),j=n((()=>{const{optionHeight:e}=w;return{transition:`transform ${$.value}ms cubic-bezier(0.17, 0.89, 0.45, 1)`,transform:`translate3d(0, ${I.scrollDistance}px, 0)`,top:`calc(50% - ${+e/2}px)`,height:`${e}px`}}));function S(e){return`transform: rotate3d(1, 0, 0, ${-I.rotation*e}deg) translate3d(0px, 0px, 104px)`}const V=n((()=>({backgroundSize:`100% ${(+w.visibleOptionNum-1)*+w.optionHeight/2}px`})));function A(e){var t;if(D.start(e),C.value&&!w.uni){const{transform:e}=null==window?void 0:window.getComputedStyle(null==(t=Y.value)?void 0:t.$el);if(w.threeDimensional){const t=Math.floor(Number.parseInt(M.value)/360),a=+e.split(", ")[5],l=+e.split(", ")[6]<0?180:0,s=360*t+Math.acos(a)/Math.PI*180+l;I.scrollDistance=-Math.abs((s/I.rotation-1)*+w.optionHeight)}else I.scrollDistance=+e.slice(7,e.length-1).split(", ")[5]}x(e,!0),I.touchParams.startY=D.deltaY.value,I.touchParams.startTime=Date.now(),I.transformY=I.scrollDistance}function z(e){D.move(e),D.isVertical()&&(C.value=!0,x(e,!0)),I.touchParams.lastY=D.deltaY.value;B(I.touchParams.lastY-I.touchParams.startY)}function R(){I.touchParams.lastY=D.deltaY.value,I.touchParams.lastTime=Date.now();const e=I.touchParams.lastY-I.touchParams.startY,t=I.touchParams.lastTime-I.touchParams.startTime;if(t<=300&&Math.abs(e)>15){B(function(e,t){const a=Math.abs(e/t);return e=a/.003*(e<0?-1:1),e}(e,t),"end",+w.swipeDuration)}else B(e,"end"),setTimeout((()=>{D.reset(),C.value=!1}),0)}function F(e){return e>=I.currIndex+8||e<=I.currIndex-8}function L(e=0,t,a=200,l){$.value="end"===t?a:0,M.value=l,I.scrollDistance=e}function B(e,t,a){const{optionHeight:l}=w;let s=e+I.transformY;if("end"===t){s>0&&(s=0),s<-(w.column.length-1)*+l&&(s=-(w.column.length-1)*+l);const e=Math.round(s/+l)*+l;L(e,t,a,(Math.abs(Math.round(e/+l))+1)*I.rotation+"deg"),I.currIndex=Math.abs(Math.round(e/+l))+1}else{let e=0;const t=(-s/+l+1)*I.rotation,a=(w.column.length+1)*I.rotation,n=0;e=H(t,n,a),n<e&&e<a&&(L(s,null,void 0,`${e}deg`),I.currIndex=Math.abs(Math.round(s/+l))+1)}}function E(){O(t,w.column[I.currIndex-1])}function U(e){const{column:t}=w,a=t.findIndex((e=>e[w.fieldNames.value]===w.value));I.currIndex=-1===a?1:a+1;const l=-1===a?0:a*+w.optionHeight;e&&E(),B(-l)}function q(){C.value=!1,$.value=0,E()}return o((()=>w.column),(e=>{w.column&&w.column.length>0&&(I.transformY=0,U(!1))}),{deep:!0}),o((()=>w.value),(e=>{I.transformY=0,U(!1)}),{deep:!0}),i((()=>{U(!0)})),(e,t)=>{const a=N;return u(),r(a,{class:"hs-picker__list",onTouchstart:A,onTouchmove:z,onTouchend:R},{default:c((()=>[m(a,{ref_key:"roller",ref:Y,class:"hs-picker-roller",style:d(e.threeDimensional?P.value:j.value),onTransitionend:q},{default:c((()=>[(u(!0),h(p,null,f(e.column,((t,l)=>(u(),h(p,{key:t[e.fieldNames.value]?t[e.fieldNames.value]:l},[t&&t[e.fieldNames.text]&&e.threeDimensional?(u(),r(a,{key:0,class:v(["hs-picker-roller-item",{"hs-picker-roller-item-hidden":F(l+1),[t[e.fieldNames.className]]:t[e.fieldNames.className]}]),style:d(S(l+1))},{default:c((()=>[g(y(t[e.fieldNames.text]),1)])),_:2},1032,["class","style"])):b("",!0),t&&t[e.fieldNames.text]&&!e.threeDimensional?(u(),r(a,{key:1,class:v(["hs-picker-roller-item-tile",{[t[e.fieldNames.className]]:t[e.fieldNames.className]}]),style:d({height:_(k)(e.optionHeight),lineHeight:_(k)(e.optionHeight)})},{default:c((()=>[g(y(t[e.fieldNames.text]),1)])),_:2},1032,["class","style"])):b("",!0)],64)))),128))])),_:1},8,["style"]),m(a,{class:"hs-picker-roller-mask",style:d(V.value)},null,8,["style"])])),_:1},8,["onTouchstart","onTouchmove"])}}}),[["__scopeId","data-v-16b19a1e"]]),U={...O,modelValue:D([]),title:I(""),cancelText:I(""),okText:I(""),columns:D([]),threeDimensional:Y,swipeDuration:C(1e3),showToolbar:Y,visibleOptionNum:C(7),optionHeight:C(36),fieldNames:{type:Object,default:()=>({})}},q={[M]:e=>e instanceof Object,[t]:e=>e instanceof Object,[$]:e=>e instanceof Object,[P]:e=>e instanceof Object},J={text:"text",value:"value",children:"children",className:""},K=`${T}-picker`;function Q(e,a){const i=l({formattedColumns:e.columns}),u=n((()=>({...J,...e.fieldNames}))),r=s([]),c=n((()=>{const e=i.formattedColumns[0],t=u.value;if(e){if(Array.isArray(e))return"multiple";if(t.children in e)return"cascade"}return"single"})),m=n((()=>{let e=[];switch(c.value){case"multiple":e=i.formattedColumns;break;case"cascade":e=((e,t)=>{const a=[],l=u.value;let s={text:"",value:"",[l.children]:e},n=0;for(;s&&s[l.children];){const e=s[l.children],o=t[n];let i=e.findIndex((e=>e[l.value]===o));-1===i&&(i=0),s=s[l.children][i],n++,a.push(e)}return a})(i.formattedColumns,r.value?r.value:[]);break;default:e=[i.formattedColumns]}return e})),d=n((()=>{const e=u.value;return m.value.map(((t,a)=>{const l=t.findIndex((t=>t[e.value]===r.value[a]));return-1===l?0:l}))})),h=s([]),p=n((()=>j(e,K))),f=n((()=>{const e=u.value;return m.value.map(((t,a)=>t.find((t=>t[e.value]===r.value[a]))||t[0]))})),v=()=>{const e=u.value;r.value&&!r.value.length&&m.value.forEach((t=>{r.value.push(t[0][e.value])})),a($,{selectedValue:r.value,selectedOptions:f.value})};return o((()=>e.modelValue),(e=>{S(e,r.value)||(r.value=V(e))}),{deep:!0,immediate:!0}),o(r,(t=>{S(t,e.modelValue)||a(P,t)}),{deep:!0}),o((()=>e.columns),(e=>{i.formattedColumns=e})),{classes:p,...A(i),columnsType:c,columnsList:m,columnFieldNames:u,cancel:()=>{a(M,{selectedValue:r.value,selectedOptions:f.value})},changeHandler:(e,l)=>{const s=u.value;if(l&&Object.keys(l).length){if(r.value=r.value?r.value:[],"cascade"===c.value){r.value[e]=l[s.value]?l[s.value]:"";let t=e,a=l;for(;a&&a[s.children]&&a[s.children][0];)r.value[t+1]=a[s.children][0][s.value],t++,a=a[s.children][0];a&&a[s.children]&&0===a[s.children].length&&(r.value=r.value.slice(0,t+1))}else r.value[e]=Object.prototype.hasOwnProperty.call(l,s.value)?l[s.value]:"";a(t,{columnIndex:e,selectedValue:r.value,selectedOptions:f.value})}},confirmHandler:()=>{h.value.length>0&&h.value.forEach((e=>{e.stopMomentum()})),v()},confirm:v,defaultValues:r,defaultIndexes:d,pickerColumn:h,swipeRef:e=>{e&&h.value.length<m.value.length&&h.value.push(e)},selectedOptions:f}}const X=a({name:K,options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}}),W=w(a({...X,props:U,emits:q,setup(e,{emit:t}){const a=e,l=t,{translate:o}=R(K),{changeHandler:i,confirm:k,defaultValues:x,defaultIndexes:T,columnsList:H,columnFieldNames:w,columnsType:O,classes:D,cancel:I,confirmHandler:Y}=Q(a,l);const{swipeRef:C,columnStyle:M}=function(){const e=s([]),t=n((()=>{const e={};return e.height=+a.visibleOptionNum*+a.optionHeight+"px",e["--line-height"]=+a.optionHeight+"px",e}));return{classes:D,columnsType:O,columnsList:H,cancel:I,changeHandler:i,defaultValues:x,pickerColumn:e,swipeRef:t=>{t&&e.value.length<H.value.length&&e.value.push(t)},translate:o,columnStyle:t}}();function $(){Y()}return(e,t)=>{const a=N;return u(),r(a,{class:v(_(D)),style:d(e.customStyle)},{default:c((()=>[e.showToolbar?(u(),r(a,{key:0,class:"hs-picker__bar"},{default:c((()=>[m(a,{class:"hs-picker__cancel hs-picker__left hs-picker__button",onClick:_(I)},{default:c((()=>[g(y(e.cancelText||_(o)("cancel")),1)])),_:1},8,["onClick"]),m(a,{class:"hs-picker__title"},{default:c((()=>[g(y(e.title),1)])),_:1}),m(a,{class:"hs-picker__confirm hs-picker__right hs-picker__button",onClick:$},{default:c((()=>[g(y(e.okText||_(o)("confirm")),1)])),_:1},8,["onClick"])])),_:1})):b("",!0),z(e.$slots,"top",{},void 0,!0),m(a,{class:"hs-picker__column",style:d(_(M))},{default:c((()=>[(u(!0),h(p,null,f(_(H),((t,l)=>(u(),r(a,{key:l,class:"hs-picker__columnitem"},{default:c((()=>[m(E,{ref_for:!0,ref:_(C),column:t,"columns-type":_(O),value:_(x)[l],"field-names":_(w),"three-dimensional":!1,"swipe-duration":e.swipeDuration,"visible-option-num":e.visibleOptionNum,"option-height":e.optionHeight,onChange:e=>{_(i)(l,e)}},null,8,["column","columns-type","value","field-names","swipe-duration","visible-option-num","option-height","onChange"])])),_:2},1024)))),128))])),_:1},8,["style"]),z(e.$slots,"default",{},void 0,!0)])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-0e90f4d0"]]);export{W as _};
