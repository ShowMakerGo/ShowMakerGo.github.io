import{d as e,J as s,T as r,o as t,c as a,w as l,h as o,X as i,O as n,N as u,C as c,r as d,Q as p,aJ as m,aK as f,aL as v,aM as h,R as y,_,D as b,aN as g,a5 as A,G as P,S as w,Y as j,a4 as q,k as x,q as E,v as I,a as $,aG as S,i as k}from"./index-9a4aa426.js";import{_ as M}from"./cellgroup.a9fc1937.js";import{f as O,a as C,F as G}from"./form.b2296b86.js";import{u as N}from"./useProvide.92abce79.js";import{_ as L}from"./cell.b00ee112.js";import{u as T}from"./useInject.f710a5e3.js";const W=`${y}-form`,F=e({name:W,options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}}),H=_(e({...F,props:O,emits:C,setup(e,{expose:y,emit:_}){const b=e,g=_;y({reset:function(){j()},submit:function(){return E(),!1},validate:E});const A=s((()=>d({}))),{internalChildren:P}=N(G,"hs-form-item")({props:b,formErrorTip:A}),w=s((()=>p(b,W)));function j(){Object.keys(A.value).forEach((e=>{A.value[e]=""}))}function q(e){let s=[];return e.forEach((e=>{var r,t,a,l;let o=e.type;o=o.name||o,"hs-form-item"===o||(null==o?void 0:o.toString().endsWith("form-item"))?s.push({prop:null==(r=e.props)?void 0:r.prop,rules:(null==(t=e.props)?void 0:t.rules)||[]}):Array.isArray(e.children)&&(null==(a=e.children)?void 0:a.length)?s=s.concat(q(e.children)):m(e.children)&&Object.keys(e.children)?(null==(l=e.children)?void 0:l.default)&&(e.children=e.children.default(),s=s.concat(q(e.children))):Array.isArray(e)&&(s=s.concat(q(e)))})),s}function x(e){e.message&&g("validate",e),A.value[e.prop]=e.message}function E(e=""){return new Promise(((s,r)=>{try{const r=q(null==P?void 0:P.map((e=>e.vnode))).map((s=>e&&e!==s.prop?Promise.resolve(!0):async function(e){const{rules:s,prop:r}=e,t=e=>new Promise(((s,r)=>{try{x(e),s(e)}catch(t){r(t)}}));r||console.warn("[NutUI] <FormItem> 使用 rules 校验规则时 , 必须设置 prop 参数");const a=f(b.modelValue,r||"");x({prop:r,message:""});const l=b.rules||{},o=[...(null==l?void 0:l[r])||[],...s];for(;o.length;){const e=o.shift(),{validator:s,...l}=e,{required:n,regex:u,message:c}=l,d={prop:r,message:c};if(n)if(Array.isArray(a)){if(!a.length)return t(d)}else if(!a&&0!==a)return t(d);if(u&&!u.test(String(a)))return t(d);if(s){const e=s(a,l);if(v(e))try{if(!1===await e)return t(d)}catch(i){return t({prop:r,message:i})}else if(!e)return t(d)}}return Promise.resolve(!0)}(s)));Promise.all(r).then((e=>{const r={valid:!0,errors:[]};(e=e.filter((e=>!0!==e))).length&&(r.valid=!1,r.errors=e),s(r)}))}catch(t){r(t)}}))}return r((()=>b.modelValue),(()=>{j()}),{immediate:!0}),(e,s)=>{const r=h;return t(),a(r,{class:n(w.value),style:u(e.customStyle),action:"#",onSubmit:c((()=>!1),["prevent"])},{default:l((()=>[o(M,null,{default:l((()=>[i(e.$slots,"default",{},void 0,!0)])),_:3})])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-ff654f1b"]]),J={...b,required:g,prop:A(""),label:A(""),rules:P([]),labelWidth:w(""),labelAlign:A("left"),bodyAlign:A("left"),errorMessageAlign:A("left"),showErrorLine:j,showErrorMessage:j,labelPosition:A(void 0),starPosition:A(void 0)},V=`${y}-form-item`,z=e({name:V,inheritAttrs:!1,options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}}),D=_(e({...z,props:J,setup(e){var r;const c=e,d=q(),m=T(G),f=s((()=>{var e,s;if(!1===c.required)return!1;const r=null==(s=null==(e=m.parent)?void 0:e.props)?void 0:s.rules;let t=!1;for(const a in r)Object.prototype.hasOwnProperty.call(r,a)&&a===c.prop&&Array.isArray(r[a])&&(t=r[a].some((e=>e.required)));return c.required||c.rules.some((e=>e.required))||t})),v=s((()=>{var e;const s=null==(e=m.parent)?void 0:e.props.labelPosition;return`hs-form-item__${c.labelPosition?c.labelPosition:s}`})),h=s((()=>{var e;const s=null==(e=m.parent)?void 0:e.props.starPosition;return`hs-form-item__star-${c.starPosition?c.starPosition:s}`})),y=s((()=>p(c,V))),_=s((()=>({width:S(c.labelWidth),textAlign:c.labelAlign}))),b=s((()=>({textAlign:c.bodyAlign}))),g=(null==(r=m.parent)?void 0:r.formErrorTip)||{},A=s((()=>({textAlign:c.errorMessageAlign})));return(e,s)=>{const r=k;return t(),a(L,{"custom-class":[{error:$(g)[e.prop],line:e.showErrorLine},y.value,v.value],"custom-style":e.customStyle},{default:l((()=>{return[e.label||(s="label",d[s])?(t(),a(r,{key:0,class:n(["hs-cell__title hs-form-item__label",{required:f.value,[h.value]:h.value}]),style:u(_.value)},{default:l((()=>[i(e.$slots,"label",{},(()=>[x(E(e.label),1)]),!0)])),_:3},8,["style","class"])):I("",!0),o(r,{class:"hs-cell__value hs-form-item__body"},{default:l((()=>[o(r,{class:"hs-form-item__body__slots",style:u(b.value)},{default:l((()=>[i(e.$slots,"default",{},void 0,!0)])),_:3},8,["style"]),$(g)[e.prop]&&e.showErrorMessage?(t(),a(r,{key:0,class:"hs-form-item__body__tips",style:u(A.value)},{default:l((()=>[x(E($(g)[e.prop]),1)])),_:1},8,["style"])):I("",!0)])),_:3})];var s})),_:3},8,["custom-class","custom-style"])}}}),[["__scopeId","data-v-2ae53fa3"]]);export{D as _,H as a};
